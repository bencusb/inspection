<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>House Handover Checklist</title>

<style>
    body { font-family: Arial; background: #f5f5f5; padding: 20px; max-width: 800px; margin: auto; }
    h2 { margin-top: 30px; border-left: 5px solid #0077ff; padding-left: 10px; }
    .section { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
    .item { display: flex; justify-content: space-between; align-items: center; margin: 6px 0; }
    .left { display: flex; align-items: center; }
    .item input[type="checkbox"] { margin-right: 10px; transform: scale(1.2); }
    .delete-btn { background: #e74c3c; color: #fff; border: none; border-radius: 5px; cursor: pointer; padding: 4px 8px; }
    .add-box { display: flex; margin-top: 10px; }
    .add-box input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
    .add-box button { margin-left: 10px; padding: 8px 12px; background: #0077ff; color: white; border: none; border-radius: 6px; cursor: pointer; }
</style>
</head>

<body>

<h1>üè† House Handover Checklist</h1>
<div id="checklist">Loading‚Ä¶</div>

<script>
let baseData = {};      // Loaded from JSON
let savedData = {};     // Loaded from localStorage

async function loadBaseJSON() {
    const res = await fetch("checklist.json");
    baseData = await res.json();

    savedData = JSON.parse(localStorage.getItem("checklistState") || "{}");

    mergeBaseIntoSaved();
    render();
}

function mergeBaseIntoSaved() {
    Object.keys(baseData).forEach(section => {
        if (!savedData[section]) savedData[section] = {};

        baseData[section].forEach(item => {
            if (!(item in savedData[section])) {
                savedData[section][item] = false; // default unchecked
            }
        });
    });

    localStorage.setItem("checklistState", JSON.stringify(savedData));
}

function saveState() {
    localStorage.setItem("checklistState", JSON.stringify(savedData));
}

function render() {
    const container = document.getElementById("checklist");
    container.innerHTML = "";

    Object.keys(savedData).forEach(section => {
        const div = document.createElement("div");
        div.className = "section";

        const h2 = document.createElement("h2");
        h2.textContent = section;
        div.appendChild(h2);

        Object.keys(savedData[section]).forEach(item => {
            const row = document.createElement("div");
            row.className = "item";

            const left = document.createElement("div");
            left.className = "left";

            const box = document.createElement("input");
            box.type = "checkbox";
            box.checked = savedData[section][item];
            box.onchange = () => {
                savedData[section][item] = box.checked;
                saveState();
            };

            const span = document.createElement("span");
            span.textContent = item;

            left.appendChild(box);
            left.appendChild(span);

            const del = document.createElement("button");
            del.className = "delete-btn";
            del.textContent = "‚úï";
            del.onclick = () => {
                delete savedData[section][item];
                saveState();
                render();
            };

            row.appendChild(left);
            row.appendChild(del);
            div.appendChild(row);
        });

        // Add new item box
        const addBox = document.createElement("div");
        addBox.className = "add-box";

        const input = document.createElement("input");
        input.placeholder = "Add new item‚Ä¶";

        const btn = document.createElement("button");
        btn.textContent = "+";
        btn.onclick = () => {
            const val = input.value.trim();
            if (!val) return;

            savedData[section][val] = false;
            saveState();
            render();
        };

        addBox.appendChild(input);
        addBox.appendChild(btn);
        div.appendChild(addBox);

        container.appendChild(div);
    });
}

loadBaseJSON();
</script>

</body>
</html>
